[gd_scene load_steps=14 format=2]

[ext_resource path="res://Scripts/Map.gd" type="Script" id=1]
[ext_resource path="res://Rifts/BlueRift.tscn" type="PackedScene" id=2]
[ext_resource path="res://Player.tscn" type="PackedScene" id=3]
[ext_resource path="res://Rifts/YellowRift.tscn" type="PackedScene" id=4]
[ext_resource path="res://Rifts/PinkRift.tscn" type="PackedScene" id=5]
[ext_resource path="res://Art/81-810178_blue-diamond-png-clipart-library-library-gemstone.png" type="Texture" id=6]
[ext_resource path="res://Reflect.gd" type="Script" id=7]

[sub_resource type="Gradient" id=1]

[sub_resource type="GradientTexture" id=2]
gradient = SubResource( 1 )

[sub_resource type="Shader" id=3]
code = "shader_type canvas_item;

uniform vec2 scale;
uniform float y_zoom;
uniform vec4 color : hint_color;
uniform sampler2D noise;
uniform vec2 distortion_scale;
uniform float intensity;
uniform float speed;

void fragment(){
	float distortion = texture(noise, UV*scale*distortion_scale + TIME*speed).x;
	distortion -= .5;
	
	float uv_height = SCREEN_PIXEL_SIZE.y / TEXTURE_PIXEL_SIZE.y;
	vec2 reflected_screenuv = vec2(SCREEN_UV.x - distortion*intensity, SCREEN_UV.y + uv_height * UV.y * scale.y * y_zoom * 2.0);
	
	vec4 reflection = texture(SCREEN_TEXTURE, reflected_screenuv);
	
	COLOR.rgb = mix(reflection.rbg, color.rgb, color.a);
	
	
	
}"

[sub_resource type="OpenSimplexNoise" id=6]

[sub_resource type="NoiseTexture" id=5]
width = 291
height = 128
seamless = true
noise = SubResource( 6 )

[sub_resource type="ShaderMaterial" id=4]
shader = SubResource( 3 )
shader_param/scale = Vector2( 18.495, 1.94207 )
shader_param/y_zoom = 0.25
shader_param/color = Color( 0.556863, 0.266667, 0.972549, 0.313726 )
shader_param/distortion_scale = Vector2( 0.066, -0.144 )
shader_param/intensity = 0.2
shader_param/speed = 0.1
shader_param/noise = SubResource( 5 )

[node name="Map" type="StaticBody2D"]
script = ExtResource( 1 )
__meta__ = {
"_edit_horizontal_guides_": [ 284.0 ],
"_edit_vertical_guides_": [ -287.0, 576.0 ]
}

[node name="Player" parent="." instance=ExtResource( 3 )]
position = Vector2( -177, 1371 )

[node name="CollisionShape2D" type="CollisionPolygon2D" parent="."]
modulate = Color( 1, 0, 0, 1 )
self_modulate = Color( 1, 0, 0, 1 )
polygon = PoolVector2Array( -19.6386, 11, -917.035, 19, -947.472, 970, -641.139, 969, -638.193, 1009, -660, 1421, -382, 1426, -382, 1457, -658, 1454, -699, 1452, -690.231, 1010, -946.254, 1005.94, -963, 1576, 1555.23, 1565, 1559.16, 947, 1476.68, 944, 1465.88, 883, 1555.23, 894, 1603.34, -5, 1481.59, -8, 1481.59, -73, 1600.39, -75, 1608.25, -1037, 1647.52, -1041, 2137, -1033, 2154, -871, 2179, 1663, 1609.23, 1652, -965.145, 1644, -1029.95, 1641, -955.326, 18, -929.799, -1069, -896.416, -1072, 1283.26, -1047, 1290.13, -1007, 1295.04, -660, 1358.86, -661, 1363.77, -617, 1284.89, -616.921, 1271.48, 382, 1390.28, 386, 1387.33, 453, 1271.48, 446, 1235.15, 1116, 1171.33, 1112, 1183, 481, 1104, 481, 1099, 428, 1190, 428, 1238.1, -1000, -869.907, -1017, -916.053, -8, 420, -11, 420, -564, 445.754, -564, 457.536, -18, 793.324, -20, 794, 103, 885, 93, 890, 151, 794.759, 153.532, 793.324, 538, 765.832, 540, 676.485, 537, 399.464, 534.144, 385.559, 1097.86, 867.943, 1104, 864.998, 1217, 377.025, 1209, 320.079, 1212, 325.334, 533.379, -148.516, 528.493, -153.166, 826, 60.8739, 824, 59.892, 859, 57.9283, 1227, 19.6367, 1227, 17.4531, 859.956, -162.003, 864, -203.24, 864, -196.367, 528, -196.367, 498, 749.141, 500, 754.256, 12, 447.715, 12 )

[node name="Polygon2D" type="Polygon2D" parent="CollisionShape2D"]
color = Color( 0, 0.133333, 1, 1 )
texture = SubResource( 2 )

[node name="BR1" type="Node" parent="."]

[node name="BlueRift" parent="BR1" groups=["BlueRift"] instance=ExtResource( 2 )]
position = Vector2( 428, -734 )
InputObjectList = [ NodePath("../Area2D"), NodePath("../Box"), NodePath("../Area2D2"), NodePath("../Platform") ]
riftOpen = false

[node name="Platform" type="StaticBody2D" parent="BR1"]
position = Vector2( 401, -72 )

[node name="Polygon2D" type="Polygon2D" parent="BR1/Platform"]
position = Vector2( 33, 72 )
offset = Vector2( -293.889, -236 )
polygon = PoolVector2Array( 100.889, 244, 491.889, 253, 488.889, 226, 98.889, 222 )

[node name="CollisionPolygon2D" type="CollisionPolygon2D" parent="BR1/Platform"]
position = Vector2( -1, 2 )
polygon = PoolVector2Array( -159, 79, 234, 86, 230, 61, -159, 54 )

[node name="Box" type="Polygon2D" parent="BR1"]
position = Vector2( 424, -1231 )
offset = Vector2( -470, -72 )
polygon = PoolVector2Array( 397.922, 71, 483.342, 154, 538.325, 86, 464.687, -1 )

[node name="Area2D" type="StaticBody2D" parent="BR1"]
position = Vector2( 1129, -937 )

[node name="Polygon2D" type="Polygon2D" parent="BR1/Area2D"]
position = Vector2( -10, 28 )
offset = Vector2( -250.889, -192 )
polygon = PoolVector2Array( 168.173, 234, 303.666, 261, 264.393, 104 )

[node name="CollisionPolygon2D" type="CollisionPolygon2D" parent="BR1/Area2D"]
polygon = PoolVector2Array( -97.2018, 70, 48.11, 98, 5.89102, -65 )

[node name="Area2D2" type="StaticBody2D" parent="BR1"]
position = Vector2( -16, -379 )

[node name="CollisionPolygon2D" type="CollisionPolygon2D" parent="BR1/Area2D2"]
position = Vector2( 12, -33 )
polygon = PoolVector2Array( -97.2018, 70, 48.11, 98, 5.89102, -65 )

[node name="Polygon2D" type="Polygon2D" parent="BR1/Area2D2"]
position = Vector2( 0, -1 )
offset = Vector2( -249, -201 )
polygon = PoolVector2Array( 168.173, 234, 303.666, 261, 264.393, 104 )

[node name="BR2" type="Node" parent="."]

[node name="BlueRift" parent="BR2" groups=["BlueRift"] instance=ExtResource( 2 )]
position = Vector2( 49, 1308 )
InputObjectList = [ NodePath("../Door") ]
riftOpen = false

[node name="Door" type="StaticBody2D" parent="BR2"]
position = Vector2( 45, 669 )

[node name="Polygon2D" type="Polygon2D" parent="BR2/Door"]
position = Vector2( -2, -2 )
offset = Vector2( -39, -676 )
polygon = PoolVector2Array( 23, 820, 57, 816, 55, 523, 23, 525 )

[node name="CollisionPolygon2D" type="CollisionPolygon2D" parent="BR2/Door"]
position = Vector2( 110.8, -1037 )
polygon = PoolVector2Array( -126, 1178, -126, 878, -92, 878, -90, 1174 )

[node name="PR" type="Node" parent="."]

[node name="PinkRift" parent="PR" instance=ExtResource( 5 )]
position = Vector2( 1100, 1350 )
InputObjectList = [ NodePath("../StaticBody2D") ]

[node name="StaticBody2D" type="StaticBody2D" parent="PR"]
position = Vector2( 1103, 1350 )
rotation = -0.00382241

[node name="Polygon2D" type="Polygon2D" parent="PR/StaticBody2D"]
position = Vector2( 1.81604, 0.118408 )
offset = Vector2( 2.1687, 3.89685 )
polygon = PoolVector2Array( -67.6324, -96.2592, -249.291, -185.954, -126.957, -11.4852 )

[node name="CollisionPolygon2D" type="CollisionPolygon2D" parent="PR/StaticBody2D"]
position = Vector2( -1102.86, -1347.23 )
polygon = PoolVector2Array( 981, 1339, 858.556, 1164.29, 1047, 1256 )

[node name="YR" type="Node" parent="."]

[node name="Platform" type="StaticBody2D" parent="YR"]
position = Vector2( -813, 596 )
rotation = 0.0106837

[node name="Polygon2D" type="Polygon2D" parent="YR/Platform"]
position = Vector2( 33, 72 )
offset = Vector2( -293.889, -236 )
polygon = PoolVector2Array( 100.889, 244, 491.889, 253, 488.889, 226, 98.889, 222 )

[node name="CollisionPolygon2D" type="CollisionPolygon2D" parent="YR/Platform"]
position = Vector2( -1, 2 )
polygon = PoolVector2Array( -159, 79, 234, 86, 230, 61, -159, 54 )

[node name="YellowRift" parent="YR" instance=ExtResource( 4 )]
position = Vector2( -788, 849 )
InputObjectList = [ NodePath("../Platform") ]

[node name="Sprite" type="Sprite" parent="."]
material = SubResource( 4 )
position = Vector2( 830, 2105 )
scale = Vector2( 18.495, 1.94207 )
texture = ExtResource( 6 )
script = ExtResource( 7 )

[connection signal="item_rect_changed" from="Sprite" to="Sprite" method="_on_Sprite_item_rect_changed"]
